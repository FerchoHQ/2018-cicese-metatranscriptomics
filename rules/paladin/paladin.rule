from os.path import join

rule paladin_index:
    input: join(ASSEMBLY_DIR, "{assembly}.fasta"),
    output: join(PALADIN_DIR, "{assembly}.fasta.bwt")
    conda: "paladin-env.yaml"
    shell: """
    paladin index -r3 {input}
    """
    
rule paladin_align:
    input:  
        reads= expand(join(TRIM_DIR, '{sample}_{end}.trim.fq.gz'), sample=SAMPLES, end=["1","2"]),
        index = join(PALADIN_DIR, "{assembly}.fasta.bwt"),
    output: join(PALADIN_DIR, "{assembly}_x_trim.bam") 
    conda: "paladin-env.yaml"
    shell:"""
    paladin align -f 125 -t 2 {params.index} {input} | samtools view -Sb - > {output}
    """
    
rule samtools_sort_paladin:
    input:  join(PALADIN_DIR, "{assembly}_x_trim.bam") 
    output:  join(PALADIN_DIR, "{assembly}_x_trim.sort.bam") 
    conda: "paladin-env.yaml"
    shell:"""
    samtools sort {input} -o {output}
    """

rule samtools_flagstat_paladin:
    input: join(PALADIN_DIR, "{assembly}_x_trim.sort.bam") 
    output: join(PALADIN_DIR, "{assembly}_x_trim.sort.bam.flagstat")
    conda: "paladin-env.yaml"
    shell:"""
    samtools flagstat {input} > {output}
    """
    
rule samtools_index_paladin:
    input: join(PALADIN_DIR, "{assembly}_x_trim.sort.bam") 
    output: join(PALADIN_DIR, "{assembly}_x_trim.sort.bam.bai") 
    conda: "paladin-env.yaml"
    shell:"""
    samtools index {input}
    """
